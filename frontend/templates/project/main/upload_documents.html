<!-- Step 1: Upload Documents -->
<div class="card mt-4 shadow-sm phase" id="phase1">
<div class="card-header bg-primary text-white">
    <h5 class="mb-0">üìÇ Upload Documents</h5>
</div>
<div class="card-body" style="padding-block-start: 10px;">

    <!-- Django Messages s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü base.html -->
    <!-- Kh√¥ng c·∫ßn container ri√™ng cho upload messages -->

    <!-- Form Upload File -->
    <form id="uploadForm" method="post" enctype="multipart/form-data" style="display:none;">
    {% csrf_token %}
    <input type="file" id="fileInput" name="file" accept=".docx,.pdf" multiple>
    </form>

    <div class="upload-box" onclick="document.getElementById('fileInput').click();">
    <i class="bi bi-cloud-arrow-up" style="font-size: 2rem;"></i>
    <p class="mt-2">Drag & Drop or Click to Upload</p>
    <small class="text-muted">Ch·ªâ h·ªó tr·ª£: .docx, .pdf (c√≥ th·ªÉ ch·ªçn nhi·ªÅu file)</small>
    </div>

    <!-- Form Nh·∫≠p Link -->
    <form method="post" class="mt-3" id="linkUploadForm">
    {% csrf_token %}
    <div class="text-center my-2">
        <span class="text-muted">‚Äî Ho·∫∑c ‚Äî</span>
    </div>
    <div class="mb-3">
        <label for="docLink" class="form-label">Nh·∫≠p ƒë∆∞·ªùng d·∫´n t√†i li·ªáu</label>
        <input type="url" class="form-control" id="docLink" name="link" placeholder="https://...">
    </div>
    <button type="submit" class="btn btn-success" id="linkUploadBtn">
        <i class="bi bi-upload"></i> X√°c nh·∫≠n
    </button>
    </form>

    <!-- Test API Button -->
    <!-- <div class="mt-3">
        <button type="button" class="btn btn-outline-info" onclick="testApiIntegration()">
            <i class="bi bi-gear"></i> Test API Integration
        </button>
        <small class="text-muted d-block mt-1">Test k·∫øt n·ªëi v·ªõi AI processing API</small>
    </div> -->

    <hr>
    <h4>üìë Uploaded Documents</h4>
    <ul class="list-group mt-3">
    {% for doc in documents %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
    <div class="flex-grow-1">
        <div class="d-flex align-items-center">
            {% if doc.file_id %}
            <span class="text-primary"><i class="bi bi-cloud-check"></i> {{ doc.original_filename|default:doc.file_id }}</span>
            <small class="text-muted ms-2">(Uploaded to server)</small>
            {% elif doc.file %}
            <a href="{{ doc.file.url }}" target="_blank">{{ doc.original_filename|default:doc.file.name|cut:"uploads/" }}</a>
            {% elif doc.link %}
            {# Show a nicer name for links: prefer original_filename if set, else basename of URL #}
            {% with doc.link|cut:"/" as _ %}{% endwith %}
            <a href="{{ doc.link }}" target="_blank">{{ doc.original_filename|default:doc.link|slice:"-50:" }}</a>
            {% endif %}
            <small class="text-muted ms-2">{{ doc.uploaded_at|date:"d/m/Y H:i" }}</small>
        </div>
        <div class="mt-1">
            <span class="badge bg-{{ doc.ai_processing_status|default:'secondary' }}">
                {% if doc.ai_processing_status == 'pending' %}
                    ‚è≥ Pending
                {% elif doc.ai_processing_status == 'processing' %}
                    üîÑ Processing
                {% elif doc.ai_processing_status == 'completed' %}
                    ‚úÖ Completed
                {% elif doc.ai_processing_status == 'failed' %}
                    ‚ùå Failed
                {% else %}
                    üìÑ Uploaded
                {% endif %}
            </span>
            {% if doc.ai_processing_status == 'completed' %}
                <span class="badge bg-success ms-2">
                    <i class="bi bi-check-circle"></i> Ready for Selection
                </span>
            {% elif doc.ai_processing_status == 'pending' %}
                <span class="badge bg-warning ms-2">
                    <i class="bi bi-clock"></i> Ready to Process
                </span>
            {% elif doc.ai_processing_status == 'processing' %}
                <span class="badge bg-info ms-2">
                    <i class="bi bi-hourglass-split"></i> Processing...
                </span>
            {% endif %}
        </div>
    </div>
    <button class="btn btn-sm btn-outline-primary me-2" onclick="viewDocument('{{ doc.file_id }}', '{{ doc.original_filename|default:doc.file_id }}', '{{ doc.link }}')">
        <i class="bi bi-eye"></i> Xem
    </button>
    <a href="{% url 'delete_document' doc.id %}" class="btn btn-sm btn-outline-danger">
        <i class="bi bi-trash"></i> Xo√°
    </a>
    </li>
    {% empty %}
        <li class="list-group-item text-muted">Ch∆∞a c√≥ t√†i li·ªáu n√†o ƒë∆∞·ª£c upload.</li>
    {% endfor %}
    </ul>
</div>
</div>